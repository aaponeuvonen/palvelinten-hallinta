# Palvelinten Hallinta

MacBook Air M2 8 cores, 8GB RAM, 256GB SSD

MacOS Sonoma 14.4 (64-bittinen, Apple Silicon)

QEMU 9.1 ARM Virtual Machine UTM:n kautta

# h2 Infraa koodina 

## x)

## https://terokarvinen.com/2024/hello-salt-infra-as-code/

- Salt työkalu otetaan käyttöön “infrastructure as code” periaatteella luomalla aluksi yksinkertainen hello world tila, joka varmistaa tiedoston olemassaolon.

  
- Tekstissä korostetaan idempotenssin merkitystä, eli useammalla suorituskerroilla tila ei muutu, kun järjestelmä on halutussa tilassa.

  
- Lopuksi muita Salt tilafunktioita kuten pkg, service ja user, jolla voi suorittaa erilaisia toimintoja


## https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml

  
- YAML käyttää avain arvo pareja, joissa avain ja arvo erotetaan kaksoispisteellä ja välilyönnillä.

  
- Sisennykset tehdään aina välilyönneillä, ei sarkaimilla, ja mahdolliset kommentit alkavat #-merkillä.

  
- Perusrakenteet ovat: yksittäinen arvo, lista (alkaa viivalla -) ja sanakirja (sisäkkäisiä avain–arvo-pareja).

## https://docs.saltproject.io/en/latest/ref/states/top.html

- Top tiedosto määrittää, mitä tiloja kullekin ryhmälle koneita on tarkoitus käyttää.

  
- Se sisältää kolme tasoa, eli ympäristö (esim. base), kohde (target, esim. kaikki koneet, tietty ryhmä) ja tilalistat (state-tiedostot).

## a)


<img width="489" height="353" alt="Screenshot 2025-11-03 at 14 15 53" src="https://github.com/user-attachments/assets/ff6b063a-0d3e-4481-8a28-2bd2ed978b69" />


## b) Topping

Rakenne 

<img width="371" height="204" alt="Tree users ja pkg komento" src="https://github.com/user-attachments/assets/cbc91929-8d95-42ab-b9d3-8ce9c1474f4d" />


Top.sls tiedosto


<img width="343" height="328" alt="top sls tiedosto pkg ja user" src="https://github.com/user-attachments/assets/a77daa36-e8b4-47aa-a43c-cf2cebb9a681" />

Komento 

  $ sudo salt-call --local state.apply

<img width="1470" height="956" alt="Screenshot 2025-11-03 at 12 13 54" src="https://github.com/user-attachments/assets/d573eb4e-af0f-408f-bcfb-b62f06ed7512" />



## c) Viisikko tiedostossa 


Hierarkia /srv/salt/ kansiossa, jokaisella oma init.sls tiedosto, josta löytyy jokaisen omat konfiguraatiot


<img width="353" height="262" alt="Tree" src="https://github.com/user-attachments/assets/d0a5ba2a-9e98-4205-b64a-40f6dbf6155f" />


Top.sls /srv/salt/ kansiossa


<img width="333" height="462" alt="Top sls" src="https://github.com/user-attachments/assets/651ff5d7-3f61-4de7-8209-a642a8d57479" />


## d) 


/srv/salt/example/init.sls 


<img width="393" height="465" alt="Example kansion init sls tiedosto" src="https://github.com/user-attachments/assets/4127f3a6-1f13-4ee6-99df-f9b9a67369fe" />


Sitten muokkasin /srv/salt/top.sls tiedostoa, että suorittaa "example" kansion sisällön

Ajoin komennon 

  $ sudo salt-call --local state.apply


<img width="343" height="512" alt="kolme funktioo" src="https://github.com/user-attachments/assets/19ec8cea-f35f-4259-9b7d-d9ca7befb625" />


Tein pelkästään tuolla yhdella komennolla paikallisen web palvelimen 

<img width="1470" height="956" alt="Screenshot 2025-11-03 at 13 05 54" src="https://github.com/user-attachments/assets/0cc3ecbe-869f-444d-be6e-97c62d08d8b3" />


Sitten ajoin vielä kerran saman

<img width="735" height="632" alt="Idempotentti" src="https://github.com/user-attachments/assets/c001bfec-d866-47a1-b019-24736da233d8" />


Se on idempotentti.


# Lähteet 

https://terokarvinen.com/2024/hello-salt-infra-as-code/

https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml

https://docs.saltproject.io/en/latest/ref/states/top.html


