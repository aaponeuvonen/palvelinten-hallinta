# Palvelinten Hallinta 

MacBook Air M2 8 cores, 8GB RAM, 256GB SSD

MacOS Sonoma 14.4 (64-bittinen, Apple Silicon)

QEMU 9.1 ARM Virtual Machine UTM:n kautta 

# h1 Viisikko

## x) 

## https://terokarvinen.com/install-salt-on-debian-13-trixie/

- Ohjeet Salt asennukseen Debianiin
- Salt on avoimen lähdekoodin konfguraationhallinta työkalu
- Sen asennukseen tarvitaan uusi ulkoinen ohjelmistovarasto, sillä Salt ei ole saatavilla
  Debianin oletuspakettivarastoissa

## https://terokarvinen.com/2021/salt-run-command-locally/

- Samat komennot toimii Windowsilla ja Linuxilla myös
- Kaikkein tärkeimmät funktiot ovat pkg, file, service, user ja cmd
- Komennoista on tehtävä idempotenttejä jotta saman toimenpiteen suorittaminen useita kertoja ei muuta lopputulosta ensimmäisen kerran jälkeen

## https://terokarvinen.com/2018/03/28/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/

- Lataa Master ja jos olet asentanut palomuurin sinun täytyy reitittää maestro oikein
- Lataa Slave, Masterin täytyy tietää mistä Slave löytyy, joten sillä on oma id
- Muokkaa minion tiedostoa siten, että se Slave noudattaa Masteria

## https://terokarvinen.com/2006/06/04/raportin-kirjoittaminen-4/

- Raportin täytyy olla toistettava, eli samassa ympäristössä samat tulokset
- Täsmällisyys, jotta raporttia lukeva henkilö ymmärtää mm. kuinka pitkään jossain vaiheessa on mennyt
- Helppolukuisuus, eli selkeä ulkoasu ja muutenkin hyvin tehty, jotta raporttia on helppo seurata
- Muista viitata lähteisiin!
- Ei saa valehdella, plagioida, tai kopioida luvattomasti kuvia netistä joihin ei ole oikeuksia!


## b) Salt lataaminen


1. Ensiksi latasin Wget:in, joka on työkalu jolla voi ladata tavaraa netistä suoraan komennolla:

  
  $ sudo apt-get install wget


Se olikin jo ladattuna


<img width="453" height="127" alt="1 1 Wget network downloader" src="https://github.com/user-attachments/assets/cfa76524-0817-47be-9cd2-faa361117bbb" />


2. Sitten tein Salt:ille oman repon ja latasin Salt:in julkisen avaimen, sekä itse Salt:in Wget:in avulla


$ wget https://packages.broadcom.com/artifactory/api/security/keypair/SaltProjectKey/public


<img width="1018" height="624" alt="1 Salt lataus wget avulla " src="https://github.com/user-attachments/assets/6786e2eb-75b9-4246-98ca-d105ba8b4dee" />


3. Tarkistin avaimen ja sen, että tiedot tulee varmasti oikeasta lähteestä less komennoilla:
   
  
  $ less public
  $ less salt.sources


<img width="757" height="210" alt="3 less salt sources komennolla" src="https://github.com/user-attachments/assets/3e32083b-9e8a-41f0-89da-b1484366e41d" />


Sekä "sormenjäljet" komennolla:


 $ gpg --show-key --with-fingerprint public


4. Sitten kopioin avaimet oikeisiin hakemistoihin:

  
  $ sudo cp public /etc/apt/keyrings/salt-archive-keyring.pgp
  $ sudo cp salt. sources /etc/apt/sources.list.d/


 <img width="619" height="36" alt="5 kopiotu äskeiset tiedostot oikeisiin sijainteihin" src="https://github.com/user-attachments/assets/43109b73-97d4-4b7e-a636-577d682b4c45" />


 5. Seuraavaksi päivitin paketit ja latasin Salt Minion:in -ja Masterin ja tarkistin sen version sekä toimivuuden suorittamala yhden oikean Salt komennon

 
  $ sudo apt-get install salt-minion salt-master

  
  <img width="843" height="857" alt="6 Latasin Salt minionin ja masterin " src="https://github.com/user-attachments/assets/453cb531-9321-480e-b554-9ecedb3568a4" />

   
  $ sudo salt-call --version

  $ sudo salt-call --local state, single file.managed /tmp/helloaapo


<img width="1310" height="680" alt="7 versio ja oikea salt komento " src="https://github.com/user-attachments/assets/467b09dc-7450-4606-a119-0e0d3ea83f88" />


Salt on ladattu ja toimii!


## c) Viisi tärkeintä

pkg komennot:

 
  $ sudo salt-call --local -l into state. single pkg.installed tree


<img width="1011" height="554" alt="8 pkg installed " src="https://github.com/user-attachments/assets/7379c229-a852-4e42-a070-e7498ea8a312" />

 
  $ sudo salt-call --local -l info state. single pkg.removed tree


<img width="967" height="805" alt="9 pkg removed " src="https://github.com/user-attachments/assets/55489a2e-807a-4516-9787-6b171f395a6e" />


file komento:

 
  $ sudo salt-call --local -l info state.single file.managed /tmp/helloaapo

 
  <img width="1375" height="601" alt="10 file managed komento" src="https://github.com/user-attachments/assets/a0514a72-8005-4397-be8d-74d1ee132183" />


service komennot: 

  
  $ sudo salt-call --local -l info state.single service.running apache2 enable=True


<img width="1145" height="576" alt="11 service running komento " src="https://github.com/user-attachments/assets/2576062d-6f35-42b6-ad23-b49552c45a5c" />

  
  $ sudo salt-call --local -l info state.single service.dead apache2 enable=False

  
  <img width="1127" height="576" alt="12 service dead kometo" src="https://github.com/user-attachments/assets/d6d93a49-6f5d-46d2-a346-4b8509db0e16" />


  user komennot: 

    $ sudo salt-call --local -l info state.single user.present aapo

 
  <img width="1010" height="764" alt="13 user present komento" src="https://github.com/user-attachments/assets/caffe60f-f63c-4c70-904b-deda40fd1c9b" />

   
    $ sudo salt-call --local -l info state.single user.absent aapo

    
  <img width="786" height="486" alt="14 user absent komento" src="https://github.com/user-attachments/assets/e8cff7db-0408-44db-822a-4dc0370d1382" />

  
  cmd komento: 
  
   
    $ sudo salt-call --local -l info state.single cmd.run 'touch /tmp/foo' creates="/tmp/foo"

   
  <img width="1072" height="440" alt="15 cmd run komento" src="https://github.com/user-attachments/assets/c6bbc928-8b26-4886-b064-cc3d7699bde4" />

  ## d) Idempotentti


Seuraavalla komennolla muokkaan kyseisen tiedoston oikeuksia:

 
  $ sudo salt-call --local state.single file.managed /tmp/foo 
  \ user=root group=root mode=644 contents="Hei Aapo\n" -l info


<img width="920" height="674" alt="Idempotenssi tiedoston muokkaaminen" src="https://github.com/user-attachments/assets/64a76250-83d7-4f99-8b32-424df75ed7bf" />


Seuraavaksi suoritan tismalleen saman komennon, mutta komento ei ylikirjoita aiempaa komentoa, vaan toteaa tiedoston olevan oikeassa tilassa


<img width="883" height="463" alt="Idempotenssi tiedoston tila on jo oikea joten ei muutoksia " src="https://github.com/user-attachments/assets/fc7079ab-4a2d-4d56-a935-bec374661bb8" />


Ensimmäinen ajokerta --> tuli muutoksia 


Toinen ajokerta --> Salt ei tee mitään, koska tila on jo kunnossa --> ei muutoksia


Periaatteena useampi ajokerta --> sama lopputulos  ei ylimääräisiä muutoksia 


# Lähteet 

https://terokarvinen.com/install-salt-on-debian-13-trixie/

https://terokarvinen.com/2021/salt-run-command-locally/

https://terokarvinen.com/2018/03/28/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/

https://terokarvinen.com/2006/06/04/raportin-kirjoittaminen-4/




    




  



  
  


    
    


   



  








  
  

